sudo: required
dist: trusty
language: objective-c
osx_image: xcode10.1

cache:
  - npm
  - bundler

addons:
  chrome: beta

before_install:
  - export LC_ALL=en_US.UTF-8
  - export LANG=en_US.UTF-8
  - bundle install
  - bundle update
  - sudo gem install fastlane -NV
  - nvm install --lts
  - nvm use --lts
  - npm install -g cordova ionic @angular/cli
  - npm install

script:
  - npm run lint
  - npm run test-ci
  - ionic build --prod -- --base-href "/friendlib-app/"
  - bundle exec fastlane beta

after_success:
  - chmod +x .travis/commit_push.bash
  - .travis/commit_push.bash

deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN
  keep-history: true
  local_dir: www
